<!DOCTYPE html>
<html lang="en">

<head>
    <!-- Google Analytics -->
    <script async src="https://www.googletagmanager.com/gtag/js?id=G-TKQQZ2E0DF"></script>
    <script>
        window.dataLayer = window.dataLayer || [];
        function gtag() { dataLayer.push(arguments); }
        gtag('js', new Date());
        gtag('config', 'G-TKQQZ2E0DF');
    </script>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blog Post - Very Good Chocolate</title>
    <meta name="description" content="Read stories and updates from Very Good Chocolate.">
    <meta name="robots" content="index, follow">
    <link rel="canonical" href="https://verygood-chocolate.com/blog-detail.html">
    <!-- Open Graph -->
    <meta property="og:type" content="article">
    <meta property="og:site_name" content="Very Good Chocolate">
    <meta property="og:title" content="Blog Post - Very Good Chocolate">
    <meta property="og:description" content="Read stories and updates from Very Good Chocolate.">
    <meta property="og:url" content="https://verygood-chocolate.com/blog-detail.html">
    <meta property="og:image" content="https://verygood-chocolate.com/assets/og-default.jpg">
    <!-- Twitter Card -->
    <meta name="twitter:card" content="summary_large_image">
    <meta name="twitter:title" content="Blog Post - Very Good Chocolate">
    <meta name="twitter:description" content="Read stories and updates from Very Good Chocolate.">
    <meta name="twitter:image" content="https://verygood-chocolate.com/assets/og-default.jpg">
    <meta name="google-adsense-account" content="ca-pub-3053552886884428">
    <link rel="icon" type="image/png" href="./favicon.png">
    <link rel="stylesheet" href="./styles.css">
    <!-- CMS Data -->
    <script src="./assets/data/blogs.js"></script>
    <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-3053552886884428"
        crossorigin="anonymous"></script>

    <!-- Google Fonts: Academic Serif Fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Merriweather:ital,wght@0,300;0,400;0,700;1,400&family=Noto+Serif+KR:wght@300;400;500;700&display=swap"
        rel="stylesheet">

    <style>
        /* ===== Academic Essay / Typst-Inspired Blog Detail Styles ===== */

        :root {
            --essay-bg: #FAFAFA;
            --essay-text: #2D2D2D;
            --essay-accent: #555;
            --essay-border: #E0E0E0;
            --essay-font-serif: 'Merriweather', 'Noto Serif KR', Georgia, 'Times New Roman', serif;
        }

        /* Page Background Override */
        body:has(.blog-detail-page) {
            background-color: var(--essay-bg);
        }

        .blog-detail-page {
            max-width: 900px;
            margin: 140px auto 120px;
            padding: 0 24px;
            background-color: var(--essay-bg);
        }

        .bd-header {
            text-align: center;
            margin-bottom: 56px;
            border-bottom: 1px solid var(--essay-border);
            padding-bottom: 48px;
        }

        .bd-meta {
            font-family: var(--essay-font-serif);
            font-size: 13px;
            color: var(--essay-accent);
            margin-bottom: 20px;
            text-transform: uppercase;
            letter-spacing: 0.12em;
            font-weight: 400;
        }

        .bd-title {
            font-family: var(--essay-font-serif);
            font-size: 32px;
            font-weight: 700;
            line-height: 1.4;
            margin-bottom: 0;
            color: var(--essay-text);
            letter-spacing: -0.02em;
        }

        /* ===== Rich Text Content (Academic Essay Style) ===== */
        .bd-content {
            font-family: var(--essay-font-serif);
            font-size: 17px;
            line-height: 1.8;
            color: var(--essay-text);
            text-align: justify;
            letter-spacing: -0.02em;
            word-break: keep-all;
            hyphens: auto;
            -webkit-hyphens: auto;
        }

        .bd-content p {
            margin-bottom: 1.6em;
            text-indent: 0;
            /* No indent for web readability */
        }

        .bd-content h2 {
            font-family: var(--essay-font-serif);
            font-size: 24px;
            font-weight: 700;
            margin-top: 2.5em;
            margin-bottom: 1em;
            color: var(--essay-text);
            letter-spacing: -0.02em;
            text-align: left;
            border-bottom: 1px solid var(--essay-border);
            padding-bottom: 0.5em;
        }

        .bd-content h3 {
            font-family: var(--essay-font-serif);
            font-size: 20px;
            font-weight: 700;
            margin-top: 2em;
            margin-bottom: 0.8em;
            color: var(--essay-text);
            letter-spacing: -0.01em;
            text-align: left;
        }

        .bd-content ul,
        .bd-content ol {
            margin-bottom: 1.6em;
            padding-left: 1.5em;
            text-align: left;
        }

        .bd-content li {
            margin-bottom: 0.5em;
            line-height: 1.7;
        }

        .bd-content blockquote {
            margin: 2em 0;
            padding: 1em 1.5em;
            border-left: 3px solid var(--essay-accent);
            background: rgba(0, 0, 0, 0.02);
            font-style: italic;
            color: var(--essay-accent);
        }

        /* ===== Magazine-Style Zigzag Image Layout ===== */
        .bd-content img {
            width: 50%;
            max-width: 420px;
            height: auto;
            border-radius: 4px;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.08);
            margin-bottom: 1.2em;
            transition: box-shadow 0.3s ease;
        }

        .bd-content img:hover {
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.12);
        }

        /* First image: Full-width Hero */
        .bd-content img.img-hero {
            float: none;
            width: 100%;
            max-width: 100%;
            display: block;
            margin: 0 auto 2em auto;
            border-radius: 6px;
            box-shadow: 0 6px 24px rgba(0, 0, 0, 0.1);
        }

        /* JS-applied classes for zigzag layout */
        .bd-content img.img-left {
            float: left;
            margin-right: 1.5em;
            margin-left: 0;
            margin-top: 0.3em;
        }

        .bd-content img.img-right {
            float: right;
            margin-left: 1.5em;
            margin-right: 0;
            margin-top: 0.3em;
        }

        /* Clearfix for content container only */
        .bd-content::after {
            content: "";
            display: table;
            clear: both;
        }

        .bd-content a {
            color: var(--essay-text);
            text-decoration: underline;
            text-underline-offset: 3px;
            text-decoration-color: rgba(45, 45, 45, 0.3);
            transition: text-decoration-color 0.2s;
        }

        .bd-content a:hover {
            text-decoration-color: var(--essay-text);
        }

        .bd-content strong {
            font-weight: 700;
        }

        .bd-content em {
            font-style: italic;
        }

        /* Footer */
        .bd-footer {
            margin-top: 64px;
            padding-top: 32px;
            border-top: 1px solid var(--essay-border);
            text-align: center;
        }

        .btn-text {
            display: inline-block;
            font-family: var(--essay-font-serif);
            text-decoration: none;
            color: var(--essay-accent);
            border-bottom: 1px solid var(--essay-accent);
            padding-bottom: 2px;
            font-size: 14px;
            letter-spacing: 0.02em;
            transition: opacity 0.2s;
        }

        .btn-text:hover {
            opacity: 0.6;
        }

        /* Language Toggle Switch (Reused) */
        .lang-switch {
            display: flex;
            align-items: center;
            background: #f0f0f0;
            border-radius: 20px;
            padding: 4px;
            cursor: pointer;
            border: none;
            margin-right: 12px;
            position: relative;
            width: 64px;
            height: 32px;
            transition: background 0.3s;
            outline: none;
            -webkit-tap-highlight-color: transparent;
        }

        .lang-switch .toggle-circle {
            width: 24px;
            height: 24px;
            background: white;
            border-radius: 50%;
            box-shadow: 0 2px 4px rgba(0, 0, 0, 0.1);
            position: absolute;
            left: 4px;
            top: 4px;
            transition: transform 0.3s cubic-bezier(0.4, 0.0, 0.2, 1);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 10px;
            font-weight: 800;
            color: var(--brand);
        }

        .lang-switch.is-kr {
            background: var(--brand);
        }

        .lang-switch.is-kr .toggle-circle {
            transform: translateX(32px);
            color: #333;
        }

        /* ===== Responsive ===== */
        @media (max-width: 768px) {
            .blog-detail-page {
                padding: 0 20px;
                margin-top: 100px;
            }

            .bd-title {
                font-size: 26px;
                line-height: 1.35;
            }

            .bd-content {
                font-size: 16px;
                line-height: 1.75;
                text-align: left;
                /* Left align on mobile for readability */
            }

            .bd-content h2 {
                font-size: 20px;
            }

            .bd-content h3 {
                font-size: 18px;
            }

            /* Mobile: Reset float, full-width centered images */
            .bd-content img,
            .bd-content img.img-hero,
            .bd-content img.img-left,
            .bd-content img.img-right {
                float: none;
                width: 100%;
                max-width: 100%;
                margin: 1.5em auto;
                margin-left: 0;
                margin-right: 0;
                display: block;
            }
        }
    </style>
</head>

<body>
    <header class="topbar">
        <div class="topbar-left">
            <a href="javascript:history.back()" class="icon-btn" id="listBtn">
                <span class="icon">←</span><span class="txt">List</span>
            </a>
        </div>
        <a class="brand" href="./index.html">
            <img class="brand-img" src="./assets/logo-type.png" alt="VERYGOOD">
        </a>
        <nav class="topbar-actions" aria-label="Top actions">
            <button class="lang-switch" id="langToggle" aria-label="Switch language">
                <span class="toggle-circle">EN</span>
            </button>
            <a class="cta" href="./index.html#shop">ORDER</a>
        </nav>
    </header>

    <main class="blog-detail-page" id="mainContent">
        <!-- Rendered by JS -->
    </main>

    <footer class="footer">
        <div class="footer-inner">
            <div class="footer-left">
                <div class="footer-brand">VERYGOOD CHOCOLATE</div>
                <div class="footer-small">© <span id="year"></span> Verygood. All rights reserved.</div>
            </div>
            <div class="footer-right">
                <a href="./privacy.html"
                    style="font-size:13px; opacity:0.7; margin-right:15px; text-decoration:none;">Privacy Policy</a>
                <a href="./terms.html"
                    style="font-size:13px; opacity:0.7; margin-right:15px; text-decoration:none;">Terms of Service</a>
            </div>
        </div>
    </footer>

    <script type="module">
        import { db } from "./assets/js/firebase-config.js";
        import { doc, getDoc } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-firestore.js";

        document.getElementById("year").textContent = new Date().getFullYear();

        // 1. Parse params
        const params = new URLSearchParams(window.location.search);
        const pid = params.get("id");
        let currentLang = params.get("lang") || "EN";
        let postData = null;

        async function initPage() {
            // First check static data
            postData = blogs.find(b => b.id === pid);

            // If not found, check Firestore
            if (!postData && pid) {
                try {
                    const docRef = doc(db, "blogs", pid);
                    const docSnap = await getDoc(docRef);
                    if (docSnap.exists()) {
                        postData = { id: docSnap.id, ...docSnap.data() };
                    }
                } catch (e) {
                    console.log("Firestore fetch skipped or failed", e);
                }
            }

            renderPost();
        }

        function renderPost() {
            const isKr = currentLang === "KR";

            // Update Header UI
            const toggleBtn = document.getElementById("langToggle");
            toggleBtn.classList.toggle("is-kr", isKr);
            toggleBtn.querySelector(".toggle-circle").textContent = isKr ? "KR" : "EN";

            const listBtnText = document.querySelector("#listBtn .txt");
            listBtnText.textContent = isKr ? "목록" : "List";

            // Update Content
            const main = document.getElementById("mainContent");

            if (!postData) {
                main.innerHTML = `
                    <div style="text-align:center; padding:100px 0;">
                        <h2>${isKr ? "글을 찾을 수 없습니다" : "Post not found"}</h2>
                        <a href="./blog.html?lang=${currentLang}" class="btn-text">${isKr ? "목록으로 돌아가기" : "Back to List"}</a>
                    </div>
                `;
                return;
            }

            const title = (isKr && postData.title_ko) ? postData.title_ko : postData.title;
            const content = (isKr && postData.content_ko) ? postData.content_ko : postData.content;

            main.innerHTML = `
                <article>
                    <div class="bd-header">
                        <div class="bd-meta">${postData.date}</div>
                        <h1 class="bd-title">${title}</h1>
                    </div>
                    <div class="bd-content">
                        ${content}
                    </div>
                    <div class="bd-footer">
                        <a href="./blog.html?lang=${currentLang}" class="btn-text">${isKr ? "목록으로 돌아가기" : "Back to List"}</a>
                    </div>
                </article>
            `;

            // Apply alternating float classes to images (zigzag layout)
            applyZigzagImages();
        }

        function applyZigzagImages() {
            const images = document.querySelectorAll('.bd-content img');
            images.forEach((img, index) => {
                // Remove any existing classes
                img.classList.remove('img-hero', 'img-left', 'img-right');

                if (index === 0) {
                    // First image: full-width hero
                    img.classList.add('img-hero');
                } else {
                    // Rest: alternating left/right (index 1 → left, 2 → right, 3 → left...)
                    if (index % 2 === 1) {
                        img.classList.add('img-left');
                    } else {
                        img.classList.add('img-right');
                    }
                }
            });
        }

        // Init
        initPage();

        // Toggle Event
        document.getElementById("langToggle").addEventListener("click", () => {
            currentLang = currentLang === "EN" ? "KR" : "EN";
            const newUrl = new URL(window.location);
            newUrl.searchParams.set("lang", currentLang);
            window.history.replaceState({}, "", newUrl);
            renderPost();
        });

    </script>
</body>

</html>